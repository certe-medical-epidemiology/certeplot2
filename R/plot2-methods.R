# ===================================================================== #
#  An R package by Certe:                                               #
#  https://github.com/certe-medical-epidemiology                        #
#                                                                       #
#  Licensed as GPL-v2.0.                                                #
#                                                                       #
#  Developed at non-profit organisation Certe Medical Diagnostics &     #
#  Advice, department of Medical Epidemiology.                          #
#                                                                       #
#  This R package is free software; you can freely use and distribute   #
#  it for both personal and commercial purposes under the terms of the  #
#  GNU General Public License version 2.0 (GNU GPL-2), as published by  #
#  the Free Software Foundation.                                        #
#                                                                       #
#  We created this package for both routine data analysis and academic  #
#  research and it was publicly released in the hope that it will be    #
#  useful, but it comes WITHOUT ANY WARRANTY OR LIABILITY.              #
# ===================================================================== #

#' Methods for [plot2()]
#' 
#' These are the implemented methods for different S3 classes to be used in [plot2()]. Since they have an extensive list of arguments, they are placed here on a separate manual page.
#' @rdname plot2-methods
#' @name plot2-methods
#' @inheritParams plot2
#' @importFrom ggplot2 fortify
#' @export
plot2.default <- function(.data,
                          x = NULL,
                          y = NULL,
                          category = NULL,
                          facet = NULL,
                          type = NULL,
                          x.title = NULL,
                          y.title = NULL,
                          title = NULL,
                          subtitle = NULL,
                          caption = NULL,
                          tag = NULL,
                          title.linelength = 60,
                          title.colour = "black",
                          subtitle.linelength = 60,
                          subtitle.colour = "grey35",
                          na.replace = "(??)",
                          na.rm = FALSE,
                          facet.position = "top",
                          facet.fill = NULL,
                          facet.bold = TRUE,
                          facet.italic = FALSE,
                          facet.size = 10,
                          facet.margin = 8,
                          facet.repeat_lbls_x = TRUE,
                          facet.repeat_lbls_y = FALSE,
                          facet.fixed_y = FALSE,
                          facet.drop = FALSE,
                          facet.nrow = NULL,
                          facet.relative = FALSE,
                          x.date_breaks = NULL,
                          x.date_labels = NULL,
                          category.focus = NULL,
                          colour = "certe",
                          colour_fill = NULL,
                          x.lbl_angle = 0,
                          x.lbl_align = NULL,
                          x.lbl_italic = FALSE,
                          x.remove = FALSE,
                          x.position = "bottom",
                          x.max_items = Inf,
                          x.max_txt = "(rest, x %n)",
                          category.max_items = Inf,
                          category.max_txt = "(rest, x %n)",
                          facet.max_items = Inf,
                          facet.max_txt = "(rest, x %n)",
                          x.breaks = NULL,
                          x.breaks_n = NULL,
                          x.trans = "identity",
                          x.expand = 0.5,
                          x.limits = NULL,
                          x.character = NULL,
                          y.remove = FALSE,
                          y.24h = FALSE,
                          y.age = FALSE,
                          y.percent = FALSE,
                          y.percent_break = 0.1,
                          y.breaks = NULL,
                          y.limits = NULL,
                          y.labels = NULL,
                          y.expand = 0.25,
                          y.trans = "identity",
                          y.position = "left",
                          category.labels = NULL,
                          category.percent = FALSE,
                          category.breaks = NULL,
                          category.limits = NULL,
                          category.expand = 0,
                          category.midpoint = NULL,
                          category.trans = "identity",
                          x.sort = NULL,
                          category.sort = TRUE,
                          facet.sort = TRUE,
                          datalabels = TRUE,
                          datalabels.round = ifelse(y.percent, 2, 1),
                          datalabels.format = "%n",
                          datalabels.colour = "grey25",
                          datalabels.fill = NULL,
                          datalabels.size = (3 * text_factor),
                          datalabels.angle = 0,
                          decimal.mark = ",",
                          big.mark = ifelse(decimal.mark == ",", ".", ","),
                          summarise_function = base::sum,
                          stacked = FALSE,
                          stackedpercent = FALSE,
                          horizontal = FALSE,
                          reverse = horizontal,
                          smooth = NULL,
                          smooth.method = NULL,
                          smooth.formula = NULL,
                          smooth.se = TRUE,
                          smooth.level = 0.95,
                          smooth.alpha = 0.15,
                          smooth.size = 0.75,
                          smooth.linetype = 3,
                          size = NULL,
                          linetype = 1,
                          binwidth = NULL,
                          width = NULL,
                          jitter_seed = NA,
                          violin_scale = "count",
                          legend.position = "top",
                          legend.title = NULL, # TRUE in numeric categories
                          legend.reverse = FALSE,
                          legend.barheight = 6,
                          legend.barwidth = 1.5,
                          legend.nbin = 300,
                          legend.italic = FALSE,
                          zoom = FALSE,
                          sep = "/",
                          print = FALSE,
                          text_factor = 1,
                          family = "Calibri",
                          theme = theme_minimal2(),
                          markdown = TRUE,
                          taxonomy_italic = markdown,
                          # old certetools pkg support
                          x.category = NULL,
                          y.category = NULL,
                          ...) {
  # ggplot2's fortify() will try to make this a data.frame,
  # so that plot2.data.frame() can be called
  plot2_exec(fortify(.data),
             x = {{ x }},
             y = {{ y }},
             category = {{ category }},
             facet = {{ facet }},
             type = type,
             x.title = x.title,
             y.title = y.title,
             title = title,
             subtitle = subtitle,
             caption = caption,
             tag = tag,
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.breaks_n = x.breaks_n,
             x.trans = x.trans,
             x.expand = x.expand,
             x.limits = x.limits,
             x.character = x.character,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.trans = y.trans,
             y.position = y.position,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.trans = category.trans,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.fill = datalabels.fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stackedpercent = stackedpercent,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.size = smooth.size,
             smooth.linetype = smooth.linetype,
             size = size,
             linetype = linetype,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = legend.title,
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             family = family,
             theme = theme,
             markdown = markdown,
             taxonomy_italic = taxonomy_italic,
             x.category = x.category,
             y.category = y.category,
             misses.x = missing(x),
             misses.y = missing(y),
             misses.category = missing(category),
             misses.facet = missing(facet),
             misses.datalabels = missing(datalabels),
             misses.colour_fill = missing(colour_fill),
             misses.x.title = missing(x.title),
             misses.y.title = missing(y.title),
             misses.title = missing(title),
             misses.subtitle = missing(subtitle),
             misses.tag = missing(tag),
             misses.caption = missing(caption),
             misses.y.percent = missing(y.percent),
             misses.zoom = missing(zoom),
             label_x = deparse(substitute(x)),
             label_y = deparse(substitute(y)),
             label_category = deparse(substitute(category)),
             label_facet = deparse(substitute(facet)),
             summarise_fn_name = deparse(substitute(summarise_function)),
             ...)
}

#' @rdname plot2-methods
#' @export
plot2.numeric <- function(.data,
                          x = NULL,
                          y = NULL,
                          category = NULL,
                          facet = NULL,
                          type = "point",
                          x.title = NULL,
                          y.title = NULL,
                          title = NULL,
                          subtitle = NULL,
                          caption = NULL,
                          tag = NULL,
                          title.linelength = 60,
                          title.colour = "black",
                          subtitle.linelength = 60,
                          subtitle.colour = "grey35",
                          na.replace = "(??)",
                          na.rm = FALSE,
                          facet.position = "top",
                          facet.fill = NULL,
                          facet.bold = TRUE,
                          facet.italic = FALSE,
                          facet.size = 10,
                          facet.margin = 8,
                          facet.repeat_lbls_x = TRUE,
                          facet.repeat_lbls_y = FALSE,
                          facet.fixed_y = FALSE,
                          facet.drop = FALSE,
                          facet.nrow = NULL,
                          facet.relative = FALSE,
                          x.date_breaks = NULL,
                          x.date_labels = NULL,
                          category.focus = NULL,
                          colour = "certe",
                          colour_fill = NULL,
                          x.lbl_angle = 0,
                          x.lbl_align = NULL,
                          x.lbl_italic = FALSE,
                          x.remove = FALSE,
                          x.position = "bottom",
                          x.max_items = Inf,
                          x.max_txt = "(rest, x %n)",
                          category.max_items = Inf,
                          category.max_txt = "(rest, x %n)",
                          facet.max_items = Inf,
                          facet.max_txt = "(rest, x %n)",
                          x.breaks = NULL,
                          x.breaks_n = NULL,
                          x.trans = "identity",
                          x.expand = 0.5,
                          x.limits = NULL,
                          x.character = NULL,
                          y.remove = FALSE,
                          y.24h = FALSE,
                          y.age = FALSE,
                          y.percent = FALSE,
                          y.percent_break = 0.1,
                          y.breaks = NULL,
                          y.limits = NULL,
                          y.labels = NULL,
                          y.expand = 0.25,
                          y.trans = "identity",
                          y.position = "left",
                          category.labels = NULL,
                          category.percent = FALSE,
                          category.breaks = NULL,
                          category.limits = NULL,
                          category.expand = 0,
                          category.midpoint = NULL,
                          category.trans = "identity",
                          x.sort = NULL,
                          category.sort = TRUE,
                          facet.sort = TRUE,
                          datalabels = FALSE,
                          datalabels.round = ifelse(y.percent, 2, 1),
                          datalabels.format = "%n",
                          datalabels.colour = "grey25",
                          datalabels.fill = NULL,
                          datalabels.size = (3 * text_factor),
                          datalabels.angle = 0,
                          decimal.mark = ",",
                          big.mark = ifelse(decimal.mark == ",", ".", ","),
                          summarise_function = base::sum,
                          stacked = FALSE,
                          stackedpercent = FALSE,
                          horizontal = FALSE,
                          reverse = horizontal,
                          smooth = NULL,
                          smooth.method = NULL,
                          smooth.formula = NULL,
                          smooth.se = TRUE,
                          smooth.level = 0.95,
                          smooth.alpha = 0.15,
                          smooth.size = 0.75,
                          smooth.linetype = 3,
                          size = NULL,
                          linetype = 1,
                          binwidth = NULL,
                          width = NULL,
                          jitter_seed = NA,
                          violin_scale = "count",
                          legend.position = "top",
                          legend.title = NULL, # TRUE in numeric categories
                          legend.reverse = FALSE,
                          legend.barheight = 6,
                          legend.barwidth = 1.5,
                          legend.nbin = 300,
                          legend.italic = FALSE,
                          zoom = FALSE,
                          sep = "/",
                          print = FALSE,
                          text_factor = 1,
                          family = "Calibri",
                          theme = theme_minimal2(),
                          markdown = TRUE,
                          taxonomy_italic = markdown,
                          # old certetools pkg support
                          x.category = NULL,
                          y.category = NULL,
                          ...) {
  y_deparse <- deparse(substitute(.data))
  df <- data.frame(y = .data, stringsAsFactors = FALSE)
  colnames(df) <- y_deparse
  df$x <- seq_len(nrow(df))
  plot2_exec(df,
             x = x,
             y = {{ y }},
             category = {{ category }},
             facet = {{ facet }},
             type = type,
             x.title = x.title,
             y.title = y_deparse,
             title = title,
             subtitle = subtitle,
             caption = caption,
             tag = tag,
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.breaks_n = x.breaks_n,
             x.trans = x.trans,
             x.expand = x.expand,
             x.limits = x.limits,
             x.character = x.character,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.trans = y.trans,
             y.position = y.position,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.trans = category.trans,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.fill = datalabels.fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stackedpercent = stackedpercent,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.size = smooth.size,
             smooth.linetype = smooth.linetype,
             size = size,
             linetype = linetype,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = legend.title,
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             family = family,
             theme = theme,
             markdown = markdown,
             taxonomy_italic = taxonomy_italic,
             x.category = x.category,
             y.category = y.category,
             misses.x = missing(x),
             misses.y = missing(y),
             misses.category = missing(category),
             misses.facet = missing(facet),
             misses.datalabels = missing(datalabels),
             misses.colour_fill = missing(colour_fill),
             misses.x.title = missing(x.title),
             misses.y.title = missing(y.title),
             misses.title = missing(title),
             misses.subtitle = missing(subtitle),
             misses.tag = missing(tag),
             misses.caption = missing(caption),
             misses.y.percent = missing(y.percent),
             misses.zoom = missing(zoom),
             label_x = deparse(substitute(x)),
             label_y = deparse(substitute(y)),
             label_category = deparse(substitute(category)),
             label_facet = deparse(substitute(facet)),
             summarise_fn_name = deparse(substitute(summarise_function)),
             ...)
}

#' @rdname plot2-methods
#' @export
plot2.freq <- function(.data,
                       x = .data$item,
                       y = .data$count,
                       category = NULL,
                       facet = NULL,
                       type = NULL,
                       x.title = "Item",
                       y.title = "Count",
                       title = NULL,
                       subtitle = NULL,
                       caption = NULL,
                       tag = NULL,
                       title.linelength = 60,
                       title.colour = "black",
                       subtitle.linelength = 60,
                       subtitle.colour = "grey35",
                       na.replace = "(??)",
                       na.rm = FALSE,
                       facet.position = "top",
                       facet.fill = NULL,
                       facet.bold = TRUE,
                       facet.italic = FALSE,
                       facet.size = 10,
                       facet.margin = 8,
                       facet.repeat_lbls_x = TRUE,
                       facet.repeat_lbls_y = FALSE,
                       facet.fixed_y = FALSE,
                       facet.drop = FALSE,
                       facet.nrow = NULL,
                       facet.relative = FALSE,
                       x.date_breaks = NULL,
                       x.date_labels = NULL,
                       category.focus = NULL,
                       colour = "certe",
                       colour_fill = NULL,
                       x.lbl_angle = 0,
                       x.lbl_align = NULL,
                       x.lbl_italic = FALSE,
                       x.remove = FALSE,
                       x.position = "bottom",
                       x.max_items = Inf,
                       x.max_txt = "(rest, x %n)",
                       category.max_items = Inf,
                       category.max_txt = "(rest, x %n)",
                       facet.max_items = Inf,
                       facet.max_txt = "(rest, x %n)",
                       x.breaks = NULL,
                       x.breaks_n = NULL,
                       x.trans = "identity",
                       x.expand = 0.5,
                       x.limits = NULL,
                       x.character = NULL,
                       y.remove = FALSE,
                       y.24h = FALSE,
                       y.age = FALSE,
                       y.percent = FALSE,
                       y.percent_break = 0.1,
                       y.breaks = NULL,
                       y.limits = NULL,
                       y.labels = NULL,
                       y.expand = 0.25,
                       y.trans = "identity",
                       y.position = "left",
                       category.labels = NULL,
                       category.percent = FALSE,
                       category.breaks = NULL,
                       category.limits = NULL,
                       category.expand = 0,
                       category.midpoint = NULL,
                       category.trans = "identity",
                       x.sort = "freq-desc",
                       category.sort = TRUE,
                       facet.sort = TRUE,
                       datalabels = TRUE,
                       datalabels.round = ifelse(y.percent, 2, 1),
                       datalabels.format = "%n",
                       datalabels.colour = "grey25",
                       datalabels.fill = NULL,
                       datalabels.size = (3 * text_factor),
                       datalabels.angle = 0,
                       decimal.mark = ",",
                       big.mark = ifelse(decimal.mark == ",", ".", ","),
                       summarise_function = base::sum,
                       stacked = FALSE,
                       stackedpercent = FALSE,
                       horizontal = FALSE,
                       reverse = horizontal,
                       smooth = NULL,
                       smooth.method = NULL,
                       smooth.formula = NULL,
                       smooth.se = TRUE,
                       smooth.level = 0.95,
                       smooth.alpha = 0.15,
                       smooth.size = 0.75,
                       smooth.linetype = 3,
                       size = NULL,
                       linetype = 1,
                       binwidth = NULL,
                       width = NULL,
                       jitter_seed = NA,
                       violin_scale = "count",
                       legend.position = "top",
                       legend.title = NULL, # TRUE in numeric categories
                       legend.reverse = FALSE,
                       legend.barheight = 6,
                       legend.barwidth = 1.5,
                       legend.nbin = 300,
                       legend.italic = FALSE,
                       zoom = FALSE,
                       sep = "/",
                       print = FALSE,
                       text_factor = 1,
                       family = "Calibri",
                       theme = theme_minimal2(),
                       markdown = TRUE,
                       taxonomy_italic = markdown,
                       # old certetools pkg support
                       x.category = NULL,
                       y.category = NULL,
                       ...) {
  plot2_exec(as.data.frame(.data, stringsAsFactors = FALSE)[, 1:2, drop = FALSE],
             x = x,
             y = y,
             category = {{ category }},
             facet = {{ facet }},
             type = type,
             x.title = x.title,
             y.title = y.title,
             title = title,
             subtitle = subtitle,
             caption = caption,
             tag = tag,
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.breaks_n = x.breaks_n,
             x.trans = x.trans,
             x.expand = x.expand,
             x.limits = x.limits,
             x.character = x.character,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.trans = y.trans,
             y.position = y.position,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.trans = category.trans,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.fill = datalabels.fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stackedpercent = stackedpercent,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.size = smooth.size,
             smooth.linetype = smooth.linetype,
             size = size,
             linetype = linetype,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = legend.title,
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             family = family,
             theme = theme,
             markdown = markdown,
             taxonomy_italic = taxonomy_italic,
             x.category = x.category,
             y.category = y.category,
             misses.x = missing(x),
             misses.y = missing(y),
             misses.category = missing(category),
             misses.facet = missing(facet),
             misses.datalabels = missing(datalabels),
             misses.colour_fill = missing(colour_fill),
             misses.x.title = missing(x.title),
             misses.y.title = missing(y.title),
             misses.title = missing(title),
             misses.subtitle = missing(subtitle),
             misses.tag = missing(tag),
             misses.caption = missing(caption),
             misses.y.percent = missing(y.percent),
             misses.zoom = missing(zoom),
             label_x = deparse(substitute(x)),
             label_y = deparse(substitute(y)),
             label_category = deparse(substitute(category)),
             label_facet = deparse(substitute(facet)),
             summarise_fn_name = deparse(substitute(summarise_function)),
             ...)
}

#' @rdname plot2-methods
#' @details For geographic information system (GIS) analysis, use the `sf` package with a data set containing geometries. The result can be used as input for [plot2()].
#' @export
plot2.sf <- function(.data,
                     x = NULL,
                     y = NULL,
                     category = NULL,
                     facet = NULL,
                     type = NULL,
                     x.title = NULL,
                     y.title = NULL,
                     title = NULL,
                     subtitle = NULL,
                     caption = NULL,
                     tag = NULL,
                     title.linelength = 60,
                     title.colour = "black",
                     subtitle.linelength = 60,
                     subtitle.colour = "grey35",
                     na.replace = "(??)",
                     na.rm = FALSE,
                     facet.position = "top",
                     facet.fill = NULL,
                     facet.bold = TRUE,
                     facet.italic = FALSE,
                     facet.size = 10,
                     facet.margin = 8,
                     facet.repeat_lbls_x = TRUE,
                     facet.repeat_lbls_y = FALSE,
                     facet.fixed_y = FALSE,
                     facet.drop = FALSE,
                     facet.nrow = NULL,
                     facet.relative = FALSE,
                     x.date_breaks = NULL,
                     x.date_labels = NULL,
                     category.focus = NULL,
                     colour = "grey25",
                     colour_fill = c("white", "certeblauw"),
                     x.lbl_angle = 0,
                     x.lbl_align = NULL,
                     x.lbl_italic = FALSE,
                     x.remove = FALSE,
                     x.position = "bottom",
                     x.max_items = Inf,
                     x.max_txt = "(rest, x %n)",
                     category.max_items = Inf,
                     category.max_txt = "(rest, x %n)",
                     facet.max_items = Inf,
                     facet.max_txt = "(rest, x %n)",
                     x.breaks = NULL,
                     x.breaks_n = NULL,
                     x.trans = "identity",
                     x.expand = 0,
                     x.limits = NULL,
                     x.character = NULL,
                     y.remove = FALSE,
                     y.24h = FALSE,
                     y.age = FALSE,
                     y.percent = FALSE,
                     y.percent_break = 0.1,
                     y.breaks = NULL,
                     y.limits = NULL,
                     y.labels = NULL,
                     y.expand = 0,
                     y.trans = "identity",
                     y.position = "left",
                     category.labels = NULL,
                     category.percent = FALSE,
                     category.breaks = NULL,
                     category.limits = NULL,
                     category.expand = 0,
                     category.midpoint = NULL,
                     category.trans = "identity",
                     x.sort = NULL,
                     category.sort = TRUE,
                     facet.sort = TRUE,
                     datalabels = TRUE,
                     datalabels.round = ifelse(y.percent, 2, 1),
                     datalabels.format = NULL,
                     datalabels.colour = "black",
                     datalabels.fill = NULL,
                     datalabels.size = (3 * text_factor),
                     datalabels.angle = 0,
                     decimal.mark = ",",
                     big.mark = ifelse(decimal.mark == ",", ".", ","),
                     summarise_function = base::sum,
                     stacked = FALSE,
                     stackedpercent = FALSE,
                     horizontal = FALSE,
                     reverse = horizontal,
                     smooth = NULL,
                     smooth.method = NULL,
                     smooth.formula = NULL,
                     smooth.se = TRUE,
                     smooth.level = 0.95,
                     smooth.alpha = 0.15,
                     smooth.size = 0.75,
                     smooth.linetype = 3,
                     size = 0.1,
                     linetype = 1,
                     binwidth = NULL,
                     width = NULL,
                     jitter_seed = NA,
                     violin_scale = "count",
                     legend.position = "right",
                     legend.title = TRUE,
                     legend.reverse = FALSE,
                     legend.barheight = 6,
                     legend.barwidth = 1.5,
                     legend.nbin = 300,
                     legend.italic = FALSE,
                     zoom = FALSE,
                     sep = "/",
                     print = FALSE,
                     text_factor = 1,
                     family = "Calibri",
                     theme = theme_minimal2(panel.grid.major = element_blank(),
                                            panel.grid.minor = element_blank(),
                                            panel.border = element_blank(),
                                            axis.title = element_blank(),
                                            axis.text = element_blank(),
                                            axis.line = element_blank(),
                                            axis.ticks = element_blank()),
                     markdown = TRUE,
                     taxonomy_italic = markdown,
                     # old certetools pkg support
                     x.category = NULL,
                     y.category = NULL,
                     ...) {
  if (!"sf" %in% rownames(utils::installed.packages())) {
    stop("plotting 'sf' objects with plot2() requires the 'sf' package", call. = FALSE)
  } else {
    requireNamespace("sf")
  }
  
  if (!is.null(x)) {
    plot2_warning("In 'sf' plots, ", font_blue("x"), " will be ignored - did you mean ", font_blue("category"), "?")
  }
  if (!is.null(y)) {
    plot2_warning("In 'sf' plots, ", font_blue("y"), " will be ignored - did you mean ", font_blue("category"), "?")
  }
  
  # df <- .data %>% 
  #   mutate(x = "", y = 0) 
  df <- .data
  df$x <- ""
  df$y <- 0
  
  plot2_exec(.data = df,
             sf_column = attributes(.data)$sf_column,
             x = x,
             y = y,
             category = {{ category }},
             facet = {{ facet }},
             type = "sf",
             x.title = x.title,
             y.title = y.title,
             title = title,
             subtitle = subtitle,
             caption = caption,
             tag = tag,
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.breaks_n = x.breaks_n,
             x.trans = x.trans,
             x.expand = x.expand,
             x.limits = x.limits,
             x.character = x.character,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.trans = y.trans,
             y.position = y.position,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.trans = category.trans,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.fill = datalabels.fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stackedpercent = stackedpercent,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.size = smooth.size,
             smooth.linetype = smooth.linetype,
             size = size,
             linetype = linetype,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = legend.title,
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             family = family,
             theme = theme,
             markdown = markdown,
             taxonomy_italic = taxonomy_italic,
             x.category = x.category,
             y.category = y.category,
             misses.x = FALSE,
             misses.y = FALSE,
             misses.category = missing(category),
             misses.facet = missing(facet),
             misses.datalabels = missing(datalabels),
             misses.colour_fill = missing(colour_fill),
             misses.x.title = missing(x.title),
             misses.y.title = missing(y.title),
             misses.title = missing(title),
             misses.subtitle = missing(subtitle),
             misses.tag = missing(tag),
             misses.caption = missing(caption),
             misses.y.percent = missing(y.percent),
             misses.zoom = missing(zoom),
             label_x = deparse(substitute(x)),
             label_y = deparse(substitute(y)),
             label_category = deparse(substitute(category)),
             label_facet = deparse(substitute(facet)),
             summarise_fn_name = deparse(substitute(summarise_function)),
             ...)
}

#' @rdname plot2-methods
#' @export
plot2.data.frame <- function(.data,
                             x = NULL,
                             y = NULL,
                             category = NULL,
                             facet = NULL,
                             type = NULL,
                             x.title = NULL,
                             y.title = NULL,
                             title = NULL,
                             subtitle = NULL,
                             caption = NULL,
                             tag = NULL,
                             title.linelength = 60,
                             title.colour = "black",
                             subtitle.linelength = 60,
                             subtitle.colour = "grey35",
                             na.replace = "(??)",
                             na.rm = FALSE,
                             facet.position = "top",
                             facet.fill = NULL,
                             facet.bold = TRUE,
                             facet.italic = FALSE,
                             facet.size = 10,
                             facet.margin = 8,
                             facet.repeat_lbls_x = TRUE,
                             facet.repeat_lbls_y = FALSE,
                             facet.fixed_y = FALSE,
                             facet.drop = FALSE,
                             facet.nrow = NULL,
                             facet.relative = FALSE,
                             x.date_breaks = NULL,
                             x.date_labels = NULL,
                             category.focus = NULL,
                             colour = "certe",
                             colour_fill = NULL,
                             x.lbl_angle = 0,
                             x.lbl_align = NULL,
                             x.lbl_italic = FALSE,
                             x.remove = FALSE,
                             x.position = "bottom",
                             x.max_items = Inf,
                             x.max_txt = "(rest, x %n)",
                             category.max_items = Inf,
                             category.max_txt = "(rest, x %n)",
                             facet.max_items = Inf,
                             facet.max_txt = "(rest, x %n)",
                             x.breaks = NULL,
                             x.breaks_n = NULL,
                             x.trans = "identity",
                             x.expand = 0.5,
                             x.limits = NULL,
                             x.character = NULL,
                             y.remove = FALSE,
                             y.24h = FALSE,
                             y.age = FALSE,
                             y.percent = FALSE,
                             y.percent_break = 0.1,
                             y.breaks = NULL,
                             y.limits = NULL,
                             y.labels = NULL,
                             y.expand = 0.25,
                             y.trans = "identity",
                             y.position = "left",
                             category.labels = NULL,
                             category.percent = FALSE,
                             category.breaks = NULL,
                             category.limits = NULL,
                             category.expand = 0,
                             category.midpoint = NULL,
                             category.trans = "identity",
                             x.sort = NULL,
                             category.sort = TRUE,
                             facet.sort = TRUE,
                             datalabels = TRUE,
                             datalabels.round = ifelse(y.percent, 2, 1),
                             datalabels.format = "%n",
                             datalabels.colour = "grey25",
                             datalabels.fill = NULL,
                             datalabels.size = (3 * text_factor),
                             datalabels.angle = 0,
                             decimal.mark = ",",
                             big.mark = ifelse(decimal.mark == ",", ".", ","),
                             summarise_function = base::sum,
                             stacked = FALSE,
                             stackedpercent = FALSE,
                             horizontal = FALSE,
                             reverse = horizontal,
                             smooth = NULL,
                             smooth.method = NULL,
                             smooth.formula = NULL,
                             smooth.se = TRUE,
                             smooth.level = 0.95,
                             smooth.alpha = 0.15,
                             smooth.size = 0.75,
                             smooth.linetype = 3,
                             size = NULL,
                             linetype = 1,
                             binwidth = NULL,
                             width = NULL,
                             jitter_seed = NA,
                             violin_scale = "count",
                             legend.position = "top",
                             legend.title = NULL, # TRUE in numeric categories
                             legend.reverse = FALSE,
                             legend.barheight = 6,
                             legend.barwidth = 1.5,
                             legend.nbin = 300,
                             legend.italic = FALSE,
                             zoom = FALSE,
                             sep = "/",
                             print = FALSE,
                             text_factor = 1,
                             family = "Calibri",
                             theme = theme_minimal2(),
                             markdown = TRUE,
                             taxonomy_italic = markdown,
                             # old certetools pkg support
                             x.category = NULL,
                             y.category = NULL,
                             ...) {
  
  plot2_exec(.data = .data,
             x = {{ x }},
             y = {{ y }},
             category = {{ category }},
             facet = {{ facet }},
             type = type,
             x.title = x.title,
             y.title = y.title,
             title = title,
             subtitle = subtitle,
             caption = caption,
             tag = tag,
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.breaks_n = x.breaks_n,
             x.trans = x.trans,
             x.expand = x.expand,
             x.limits = x.limits,
             x.character = x.character,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.trans = y.trans,
             y.position = y.position,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.trans = category.trans,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.fill = datalabels.fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stackedpercent = stackedpercent,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.size = smooth.size,
             smooth.linetype = smooth.linetype,
             size = size,
             linetype = linetype,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = legend.title,
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             family = family,
             theme = theme,
             markdown = markdown,
             taxonomy_italic = taxonomy_italic,
             x.category = x.category,
             y.category = y.category,
             misses.x = missing(x),
             misses.y = missing(y),
             misses.category = missing(category),
             misses.facet = missing(facet),
             misses.datalabels = missing(datalabels),
             misses.colour_fill = missing(colour_fill),
             misses.x.title = missing(x.title),
             misses.y.title = missing(y.title),
             misses.title = missing(title),
             misses.subtitle = missing(subtitle),
             misses.tag = missing(tag),
             misses.caption = missing(caption),
             misses.y.percent = missing(y.percent),
             misses.zoom = missing(zoom),
             label_x = deparse(substitute(x)),
             label_y = deparse(substitute(y)),
             label_category = deparse(substitute(category)),
             label_facet = deparse(substitute(facet)),
             summarise_fn_name = deparse(substitute(summarise_function)),
             ...) 
}

#' @rdname plot2-methods
#' @importFrom dplyr `%>%` filter mutate select
#' @details For antimicrobial resistance (AMR) data analysis, use the [`bug_drug_combinations()`][AMR::bug_drug_combinations()] function from the `AMR` package on a data set with antibiograms. The result can be used as input for [plot2()].
#' @param minimum minimum number of results, defaults to `30`
#' @param remove_intrinsic_resistant a [logical] to indicate that rows with 100% resistance must be removed from the data set before plotting
#' @export
plot2.bug_drug_combinations <- function(.data,
                                        x = ab,
                                        y = value,
                                        category = name,
                                        facet = mo,
                                        type = "column",
                                        x.title = "",
                                        y.title = "",
                                        title = NULL,
                                        subtitle = NULL,
                                        caption = NULL,
                                        tag = NULL,
                                        title.linelength = 60,
                                        title.colour = "black",
                                        subtitle.linelength = 60,
                                        subtitle.colour = "grey35",
                                        na.replace = "(??)",
                                        na.rm = FALSE,
                                        facet.position = "top",
                                        facet.fill = NULL,
                                        facet.bold = TRUE,
                                        facet.italic = FALSE,
                                        facet.size = 10,
                                        facet.margin = 8,
                                        facet.repeat_lbls_x = TRUE,
                                        facet.repeat_lbls_y = FALSE,
                                        facet.fixed_y = FALSE,
                                        facet.drop = FALSE,
                                        facet.nrow = NULL,
                                        facet.relative = FALSE,
                                        x.date_breaks = NULL,
                                        x.date_labels = NULL,
                                        category.focus = NULL,
                                        colour = stats::setNames(colourpicker("certe_rsi2", 3),
                                                                 c("R", "I", "S")),
                                        colour_fill = NULL,
                                        x.lbl_angle = ifelse(horizontal, 0, 90),
                                        x.lbl_align = NULL,
                                        x.lbl_italic = FALSE,
                                        x.remove = FALSE,
                                        x.position = "bottom",
                                        x.max_items = Inf,
                                        x.max_txt = "(rest, x %n)",
                                        category.max_items = Inf,
                                        category.max_txt = "(rest, x %n)",
                                        facet.max_items = Inf,
                                        facet.max_txt = "(rest, x %n)",
                                        x.breaks = NULL,
                                        x.breaks_n = NULL,
                                        x.trans = "identity",
                                        x.expand = 0.5,
                                        x.limits = NULL,
                                        x.character = NULL,
                                        y.remove = FALSE,
                                        y.24h = FALSE,
                                        y.age = FALSE,
                                        y.percent = FALSE,
                                        y.percent_break = 0.1,
                                        y.breaks = NULL,
                                        y.limits = NULL,
                                        y.labels = NULL,
                                        y.expand = 0.25,
                                        y.trans = "identity",
                                        y.position = "left",
                                        category.labels = NULL,
                                        category.percent = FALSE,
                                        category.breaks = NULL,
                                        category.limits = NULL,
                                        category.expand = 0,
                                        category.midpoint = NULL,
                                        category.trans = "identity",
                                        x.sort = NULL,
                                        category.sort = FALSE,
                                        facet.sort = TRUE,
                                        datalabels = TRUE,
                                        datalabels.round = ifelse(y.percent, 2, 1),
                                        datalabels.format = "%n",
                                        datalabels.colour = "grey25",
                                        datalabels.fill = NULL,
                                        datalabels.size = (3 * text_factor),
                                        datalabels.angle = 0,
                                        decimal.mark = ",",
                                        big.mark = ifelse(decimal.mark == ",", ".", ","),
                                        summarise_function = base::sum,
                                        stacked = FALSE,
                                        stackedpercent = TRUE,
                                        horizontal = TRUE,
                                        reverse = TRUE,
                                        smooth = NULL,
                                        smooth.method = NULL,
                                        smooth.formula = NULL,
                                        smooth.se = TRUE,
                                        smooth.level = 0.95,
                                        smooth.alpha = 0.15,
                                        smooth.size = 0.75,
                                        smooth.linetype = 3,
                                        size = NULL,
                                        linetype = 1,
                                        binwidth = NULL,
                                        width = NULL,
                                        jitter_seed = NA,
                                        violin_scale = "count",
                                        legend.position = "top",
                                        legend.title = NULL, # TRUE in numeric categories
                                        legend.reverse = FALSE,
                                        legend.barheight = 6,
                                        legend.barwidth = 1.5,
                                        legend.nbin = 300,
                                        legend.italic = FALSE,
                                        zoom = FALSE,
                                        sep = "/",
                                        print = FALSE,
                                        text_factor = 1,
                                        family = "Calibri",
                                        theme = theme_minimal2(),
                                        markdown = TRUE,
                                        taxonomy_italic = markdown,
                                        # old certetools pkg support
                                        x.category = NULL,
                                        y.category = NULL,
                                        minimum = 30,
                                        remove_intrinsic_resistant = TRUE,
                                        ...) {
  
  ab_name <- getExportedValue(name = "ab_name", ns = asNamespace("AMR"))
  pivot_longer <- getExportedValue(name = "pivot_longer", ns = asNamespace("tidyr"))
  
  df <- .data
  if (isTRUE(remove_intrinsic_resistant)) {
    df <- df %>% 
      filter(total != R)
  }
  df <- df %>% 
    filter(total >= minimum) %>% 
    select(-total) %>%
    mutate(ab = ab_name(ab)) %>% 
    pivot_longer(-c(mo, ab))
  df$name <- factor(df$name, levels = c("S", "I", "R"), ordered = TRUE)
  
  plot2_exec(.data = df,
             x = {{ x }},
             y = {{ y }},
             category = {{ category }},
             facet = {{ facet }},
             type = type,
             x.title = x.title,
             y.title = y.title,
             title = title,
             subtitle = subtitle,
             caption = caption,
             tag = tag,
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.breaks_n = x.breaks_n,
             x.trans = x.trans,
             x.expand = x.expand,
             x.limits = x.limits,
             x.character = x.character,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.trans = y.trans,
             y.position = y.position,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.trans = category.trans,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.fill = datalabels.fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stackedpercent = stackedpercent,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.size = smooth.size,
             smooth.linetype = smooth.linetype,
             size = size,
             linetype = linetype,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = legend.title,
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             family = family,
             theme = theme,
             markdown = markdown,
             taxonomy_italic = taxonomy_italic,
             x.category = x.category,
             y.category = y.category,
             misses.x = missing(x),
             misses.y = missing(y),
             misses.category = missing(category),
             misses.facet = missing(facet),
             misses.datalabels = missing(datalabels),
             misses.colour_fill = missing(colour_fill),
             misses.x.title = FALSE,
             misses.y.title = FALSE,
             misses.title = missing(title),
             misses.subtitle = missing(subtitle),
             misses.tag = missing(tag),
             misses.caption = missing(caption),
             misses.y.percent = missing(y.percent),
             misses.zoom = missing(zoom),
             label_x = deparse(substitute(x)),
             label_y = deparse(substitute(y)),
             label_category = deparse(substitute(category)),
             label_facet = deparse(substitute(facet)),
             summarise_fn_name = deparse(substitute(summarise_function)),
             ...) 
}
